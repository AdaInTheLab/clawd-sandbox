<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <title>Code Vision Proto</title>\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-one-dark.min.css">\n  <style>\n    :root {\n      --bg: #0d1117;\n      --fg: #c9d1d9;\n      --neon-cyan: #00d4ff;\n      --neon-amber: #ffa500;\n      --purple: #bb86fc;\n    }\n    * { box-sizing: border-box; }\n    body {\n      background: var(--bg);\n      color: var(--fg);\n      font-family: 'SF Mono', Monaco, monospace;\n      margin: 0;\n      height: 100vh;\n      display: grid;\n      grid-template-columns: 300px 1fr 300px;\n      grid-template-rows: 1fr;\n      overflow: hidden;\n    }\n    #sidebar { \n      border-right: 1px solid #30363d;\n      overflow-y: auto;\n      padding: 20px;\n      background: #161b22;\n    }\n    #code { \n      overflow-y: auto;\n      padding: 20px;\n    }\n    #eval-panel {\n      border-left: 1px solid #30363d;\n      overflow-y: auto;\n      padding: 20px;\n      background: #161b22;\n      display: flex;\n      flex-direction: column;\n    }\n    #eval-input {\n      flex: 1;\n      background: #0d1117;\n      color: var(--fg);\n      border: 1px solid #30363d;\n      padding: 10px;\n      font-family: inherit;\n      resize: none;\n      margin-bottom: 10px;\n    }\n    #eval-btn {\n      background: var(--purple);\n      color: white;\n      border: none;\n      padding: 8px 16px;\n      cursor: pointer;\n      font-family: inherit;\n      margin-bottom: 10px;\n    }\n    #eval-btn:hover { opacity: 0.8; }\n    #eval-out {\n      background: #000;\n      color: #00ff00;\n      padding: 10px;\n      min-height: 100px;\n      overflow: auto;\n      white-space: pre-wrap;\n      font-size: 14px;\n    }\n    ul { list-style: none; padding-left: 20px; }\n    li { margin: 2px 0; }\n    li > span { cursor: pointer; }\n    li > span:hover { color: var(--neon-cyan); text-shadow: 0 0 5px var(--neon-cyan); }\n    pre { margin: 0; }\n    .token {\n      transition: filter 0.2s, text-shadow 0.2s;\n    }\n    .token:hover {\n      filter: brightness(1.3);\n      text-shadow: 0 0 8px var(--neon-amber), 0 0 4px var(--neon-cyan);\n    }\n    .token.comment { color: var(--neon-cyan) !important; }\n    .token.string,\n    .token.template-string .token.interpolation { color: var(--neon-amber) !important; }\n    .token.function,\n    .token.keyword { color: var(--purple) !important; }\n    .token.number { color: #8be9fd !important; }\n    .token.operator { color: var(--neon-cyan) !important; }\n  </style>\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>\n  <script src="https://unpkg.com/acorn@8.11.3/dist/acorn.js"></script>\n</head>\n<body>\n  <div id="sidebar">Loading AST tree...</div>\n  <div id="code">Loading code...</div>\n  <div id="eval-panel">\n    <textarea id="eval-input" placeholder="Eval JS snippet here...&#10;Click to focus, paste &amp; eval."></textarea>\n    <button id="eval-btn" onclick="evalIt()">Eval</button>\n    <pre id="eval-out">Results here...</pre>\n  </div>\n  <script>\n    function escapeHtml(text) {\n      const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#039;' };\n      return text.replace(/[&<>\\"']/g, m => map[m]);\n    }\n\n    async function loadFile() {\n      const params = new URLSearchParams(location.search);\n      const file = params.get('file');\n      if (!file) {\n        document.getElementById('code').innerHTML = '<p style="color:orange">No ?file= param. e.g. ?file=example.js</p>';\n        return;\n      }\n      try {\n        const resp = await fetch(decodeURIComponent(file));\n        const code = await resp.text();\n        const codeDiv = document.getElementById('code');\n        let lang = 'text';\n        if (file.endsWith('.js')) lang = 'javascript';\n        else if (file.match(/\\.html?$/)) lang = 'markup';\n        else if (file.match(/\\.md$/)) lang = 'markdown';\n        codeDiv.innerHTML = `<pre class="language-${lang}"><code>${escapeHtml(code)}</code></pre>`;\n        Prism.highlightAllUnder(codeDiv);\n\n        const sidebar = document.getElementById('sidebar');\n        if (lang === 'javascript') {\n          const ast = acorn.parse(code, {ecmaVersion: 2022, sourceType: 'module', locations: true});\n          renderTree(ast, sidebar);\n        } else {\n          sidebar.innerHTML = '<p style="color:orange">AST tree for JS files only.</p>';\n        }\n      } catch (e) {\n        document.getElementById('code').innerHTML = `<p style="color:red">Load error: ${e.message}</p>`;\n      }\n    }\n\n    function renderTree(node, container, depth = 0) {\n      if (depth > 4) {\n        const p = document.createElement('p');\n        p.textContent = '...';\n        p.style.color = 'gray';\n        container.appendChild(p);\n        return;\n      }\n      const ul = document.createElement('ul');\n      const li = document.createElement('li');\n      const span = document.createElement('span');\n      span.textContent = node.type;\n      if (node.loc) {\n        span.textContent += ` (L${node.loc.start.line}:${node.loc.start.column})`;\n      }\n      if (node.id?.name) span.textContent += ` &quot;${node.id.name}&quot;`; \n      li.appendChild(span);\n      const addSub = (nodes) => {\n        if (Array.isArray(nodes)) {\n          nodes.forEach(n => renderTree(n, ul, depth + 1));\n        } else if (nodes) {\n          renderTree(nodes, ul, depth + 1);\n        }\n      };\n      if (node.body) addSub(node.body);\n      if (node.declarations) addSub(node.declarations);\n      if (node.elements) addSub(node.elements);\n      li.appendChild(ul);\n      container.appendChild(li);\n    }\n\n    function evalIt() {\n      const input = document.getElementById('eval-input');\n      const out = document.getElementById('eval-out');\n      try {\n        // sandboxed eval\n        const func = new Function('return (' + input.value + ')')();\n        out.textContent = JSON.stringify(func, null, 2) || 'undefined';\n        out.style.color = '#00ff00';\n      } catch (e) {\n        out.textContent = e.message || e.stack;\n        out.style.color = '#ff4444';\n      }\n      out.scrollTop = 0;\n    }\n\n    window.addEventListener('load', loadFile);\n  </script>\n</body>\n</html>