<!DOCTYPE html>
<html>
<head>
<title>AI Allowance Dashboard üêæ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { 
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); 
    color: #00ffff; 
    font-family: 'Courier New', monospace; 
    padding: 20px; 
    margin: 0;
  }
  h1 { text-align: center; text-shadow: 0 0 10px cyan; }
  #balances { font-size: 1.5em; text-align: center; margin: 20px 0; }
  #funds { text-align: center; margin: 20px 0; }
  button { background: cyan; color: navy; padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; }
  button:hover { background: #00ccff; box-shadow: 0 0 10px cyan; }
  canvas { display: block; margin: 20px auto; border: 1px solid cyan; }
  pre { background: rgba(0,255,255,0.1); padding: 10px; border-radius: 5px; }
</style>
</head>
<body>
  <h1>ü§ñ AI Allowance Dashboard</h1>
  <div id="balances">Loading...</div>
  <div id="funds">
    <h2>üí∞ Fund Wallets</h2>
    <button onclick="fund('clawd-sol')">Fund Clawd SOL</button>
    <button onclick="fund('clawd-usdc')">Fund Clawd USDC</button>
    <button onclick="fund('koda-btc')">Fund Koda BTC</button>
  </div>
  <canvas id="chart" width="900" height="400"></canvas>
  <script>
    async function loadData() {
      try {
        const balRes = await fetch('/api/balances');
        const bal = await balRes.json();
        const balancesDiv = document.getElementById('balances');
        const clawd = bal.clawd || {};
        const koda = bal.koda || {};
        balancesDiv.innerHTML = `
          <h2>Clawd (SOL Devnet)</h2>
          SOL: ${clawd.sol || 0} | USDC: ${clawd.usdc || 0}<br>
          <h2>Koda (BTC Testnet)</h2>
          BTC: ${(koda.btc || 0).toFixed(8)}
        `;
      } catch (e) {
        document.getElementById('balances').innerHTML = `Error: ${e.message}`;
      }
      try {
        const histRes = await fetch('/api/history');
        const history = await histRes.json();
        const ctx = document.getElementById('chart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: history.map(h => h.date),
            datasets: [
              { label: 'Clawd USDC', data: history.map(h => h.clawd_usdc), borderColor: 'cyan', fill: false },
              { label: 'Koda BTC x10k', data: history.map(h => h.koda_btc * 10000), borderColor: 'orange', fill: false }
            ]
          },
          options: { scales: { y: { beginAtZero: true } } }
        });
      } catch (e) {
        console.error('Chart error:', e);
      }
    }
    async function fund(type) {
      try {
        const res = await fetch('/api/wallets');
        const w = await res.json();
        let url;
        if (type === 'clawd-sol') url = w.clawd.solFaucet;
        else if (type === 'clawd-usdc') url = w.clawd.usdcFaucet;
        else if (type === 'koda-btc') url = w.koda.btcFaucet;
        window.open(url, '_blank');
      } catch (e) {
        alert('Fund error: ' + e.message);
      }
    }
    loadData();
    setInterval(loadData, 30000); // refresh 30s
  </script>
</body>
</html>
